name: 🏗️ Build

on:
  workflow_dispatch:
    inputs:
      type:
        description: 'Release type'
        required: true
        default: 'MINOR'
        type: choice
        options:
          - MAJOR
          - MINOR
          - PATCH

jobs:
  build:
    name: Build
    runs-on: windows-latest
    env:
      TOKEN: ${{ secrets.TOKEN }}

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Setup up PNPM
        uses: pnpm/action-setup@v2
        with:
          version: 7

      - name: Setup up Node 16
        uses: actions/setup-node@v2
        with:
          node-version: 16
          cache: pnpm

      - name: Shamefull hoist
        shell: bash
        run: |
          echo "shamefully-hoist=true" >> .npmrc

      - name: Install dependencies
        run: pnpm install

      - name: Update version
        run: pnpm update-version ${{ github.event.inputs.type }}

      - name: 🏗️ Build app
        env:
          NODE_OPTIONS: "--max_old_space_size=4096"
        run: yarn run make

      - name: 🚀 Deploy
        run: pnpm release
